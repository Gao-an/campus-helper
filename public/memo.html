<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Memo Module</title>

    <style>
        /* æœ€å¤–å±‚æ¡† */
        #memo-module {
            width: 100%;
            max-width: 360px;
            margin: 12px auto;
            border: 2px solid #666;
            padding: 10px;
            font-family: sans-serif;
            position: relative;
            box-sizing: border-box;
            min-height: 520px;
            background: #fff;
        }

        /* é¡¶éƒ¨æœç´¢åŒº */
        .memo-header {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .memo-header input {
            flex: 1;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #aaa;
        }

        .memo-header button {
            width: 40px;
            border-radius: 20px;
            cursor: pointer;
        }

        /* åˆ—è¡¨åŒº */
        .memo-list {
            border: 1px solid #ddd;
            height: 330px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 5px;
        }

        .memo-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 4px;
            border-bottom: 1px solid #eee;
        }

        .memo-item-title {
            cursor: pointer;
            flex: 1;
            min-width: 0;
            /* allow flex item to shrink for text-overflow to work */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* åœ†å½¢é€‰æ‹©æ¡† */
        .memo-select-circle {
            width: 16px;
            height: 16px;
            border: 1px solid #333;
            border-radius: 50%;
            cursor: pointer;
        }

        .memo-select-circle.selected {
            background: #000;
        }

        /* åº•éƒ¨æŒ‰é’® */
        .memo-footer {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .memo-footer button {
            width: 45%;
            padding: 6px;
        }

        /* è¯¦æƒ…ï¼ˆæ–°å»º/ç¼–è¾‘ï¼‰ç•Œé¢ */
        .memo-detail {
            position: absolute;
            inset: 10px;
            /* ç­‰åŒäº top:10px; right:10px; bottom:10px; left:10pxï¼Œå°Šé‡ memo-module çš„ padding */
            background: white;
            border: 2px solid #444;
            padding: 12px;
            display: none;
            z-index: 99;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* è¯¦æƒ…æ ‡é¢˜æ  */
        .memo-detail-header {
            display: flex;
            justify-content: flex-end;
        }

        .memo-close-btn {
            border: 1px solid #888;
            background: #eee;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 18px;
            cursor: pointer;
        }

        /* æ ‡é¢˜è¾“å…¥æ¡† */
        .memo-title {
            font-size: 20px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            box-sizing: border-box;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* æ­£æ–‡ */
        .memo-content {
            width: 100%;
            height: 280px;
            box-sizing: border-box;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: sans-serif;
            font-size: 14px;
        }

        /* æ ‡ç­¾å®¹å™¨ */
        .memo-tags {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-content: flex-start;
        }

        /* æ ‡ç­¾ */
        .memo-tag {
            display: inline-block;
            background: #eee;
            padding: 3px 8px;
            border-radius: 10px;
            margin-right: 5px;
            margin-bottom: 5px;
            position: relative;
        }

        /* æ ‡ç­¾åˆ é™¤æŒ‰é’® */
        .memo-tag-delete {
            display: none;
            position: absolute;
            top: -8px;
            right: -8px;
            width: 18px;
            height: 18px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 18px;
            padding: 0;
        }

        .memo-tag:hover .memo-tag-delete {
            display: block;
        }

        .memo-tag-add {
            width: 22px;
            height: 22px;
            border: 1px solid #888;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-left: 5px;
        }

        .memo-tag-input-box {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .memo-tag-input {
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 13px;
        }

        .memo-tag-error {
            color: #b00;
            font-size: 12px;
        }

        /* å“åº”å¼ï¼šæ‰‹æœºç«¯ä¼˜åŒ– */
        @media (max-width: 420px) {
            #memo-module {
                width: calc(100% - 20px);
                max-width: none;
                margin: 8px auto;
                padding: 10px;
                min-height: auto;
            }

            .memo-header input {
                font-size: 16px;
                padding: 10px;
            }

            .memo-header button {
                width: 48px;
                height: 48px;
                border-radius: 8px;
            }

            .memo-list {
                height: 260px;
            }

            .memo-item {
                padding: 10px 6px;
            }

            .memo-select-circle {
                width: 22px;
                height: 22px;
            }

            .memo-footer {
                margin-top: 10px;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .memo-footer button {
                width: 100%;
                padding: 10px;
                box-sizing: border-box;
            }

            .memo-detail {
                position: absolute;
                inset: 10px;
                padding: 10px;
                border-radius: 0;
                box-sizing: border-box;
                overflow-y: auto;
            }

            .memo-title {
                font-size: 18px;
            }

            .memo-content {
                height: 35vh;
                margin: 6px 0;
            }

            .memo-tag-add {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                font-size: 20px;
            }
        }
    </style>
</head>

<body>

    <div id="memo-module">

        <!-- æœç´¢æ  -->
        <div class="memo-header">
            <input id="memo-search" placeholder="æœç´¢â€¦" />
            <button id="memo-search-btn">ğŸ”</button>
        </div>

        <!-- åˆ—è¡¨ -->
        <div id="memo-list" class="memo-list"></div>

        <!-- åº•éƒ¨æŒ‰é’® -->
        <div class="memo-footer">
            <button id="memo-back-btn" style="display:none;">è¿”å›</button>
            <button id="memo-select-btn">é€‰æ‹©</button>
            <button id="memo-new-btn">æ–°å»º</button>
            <button id="memo-delete-btn" style="display:none;">åˆ é™¤</button>
        </div>

        <!-- è¯¦æƒ…ç•Œé¢ -->
        <div id="memo-detail" class="memo-detail">
            <div class="memo-detail-header">
                <button id="memo-detail-close" class="memo-close-btn">âœ–</button>
            </div>

            <input id="memo-title" class="memo-title" placeholder="æ ‡é¢˜â€¦" />
            <div id="memo-warning"
                style="color:#b00;background:#fee;padding:6px;border-radius:4px;display:none;margin:6px 0;"></div>
            <textarea id="memo-content" class="memo-content" placeholder="æ­£æ–‡â€¦"></textarea>

            <div id="memo-tags" class="memo-tags"></div>
        </div>
    </div>

    <script>
        /* åˆå§‹å¤‡å¿˜å½• */
        let memos = [
            { id: 1, title: "ä¹°èœæ¸…å•", content: "é¸¡è›‹ ç‰›å¥¶ è¥¿çº¢æŸ¿", tags: ["ç”Ÿæ´»"] },
            { id: 2, title: "å­¦ä¹ è®¡åˆ’", content: "å†™JS é¡¹ç›®ä¼˜åŒ–", tags: ["é‡è¦", "å­¦ä¹ "] },
            { id: 3, title: "çº¦è§æœ‹å‹", content: "å‘¨äº”ä¸‹åˆ3ç‚¹", tags: [] }
        ];

        let selectMode = false;
        let editingId = null;

        /* DOM */
        const listDom = document.getElementById("memo-list");
        const detailDom = document.getElementById("memo-detail");
        const titleDom = document.getElementById("memo-title");
        const contentDom = document.getElementById("memo-content");
        const tagsDom = document.getElementById("memo-tags");
        const warningDom = document.getElementById("memo-warning");

        /* æ¸²æŸ“åˆ—è¡¨ */
        function renderList(filter = "") {
            listDom.innerHTML = "";

            memos
                .filter(m =>
                    m.title.includes(filter) ||
                    m.content.includes(filter) ||
                    m.tags.some(t => t.includes(filter))
                )
                .forEach(m => {
                    const row = document.createElement("div");
                    row.className = "memo-item";

                    const t = document.createElement("div");
                    t.className = "memo-item-title";
                    t.textContent = m.title || "(æ— æ ‡é¢˜)";
                    t.title = m.title || "(æ— æ ‡é¢˜)";
                    t.onclick = () => openDetail(m.id);
                    row.appendChild(t);

                    if (selectMode) {
                        const c = document.createElement("div");
                        c.className = "memo-select-circle";
                        c.onclick = () => {
                            c.classList.toggle("selected");
                            m.selected = c.classList.contains("selected");
                        };
                        row.appendChild(c);
                    }

                    listDom.appendChild(row);
                });
        }

        /* æœç´¢ */
        document.getElementById("memo-search-btn").onclick = () => {
            renderList(document.getElementById("memo-search").value.trim());
        };

        document.getElementById("memo-search").onkeypress = (e) => {
            if (e.key === "Enter") {
                renderList(document.getElementById("memo-search").value.trim());
            }
        };

        /* é€‰æ‹©æ¨¡å¼ */
        document.getElementById("memo-select-btn").onclick = () => {
            selectMode = true;

            // åœ¨é€‰æ‹©æ¨¡å¼ä¸‹ï¼šæ˜¾ç¤ºå·¦ä¾§è¿”å›æŒ‰é’®ä¸å³ä¾§åˆ é™¤æŒ‰é’®ï¼Œéšè—â€œé€‰æ‹©/æ–°å»ºâ€æŒ‰é’®
            document.getElementById("memo-select-btn").style.display = "none";
            document.getElementById("memo-new-btn").style.display = "none";
            document.getElementById("memo-back-btn").style.display = "block";
            document.getElementById("memo-delete-btn").style.display = "block";

            renderList();
        };

        /* é€€å‡ºé€‰æ‹©æ¨¡å¼ */
        function exitSelect() {
            selectMode = false;

            memos.forEach(m => delete m.selected);

            document.getElementById("memo-select-btn").style.display = "block";
            document.getElementById("memo-new-btn").style.display = "block";
            document.getElementById("memo-delete-btn").style.display = "none";
            document.getElementById("memo-back-btn").style.display = "none";

            renderList();
        }

        document.getElementById("memo-delete-btn").onclick = () => {
            memos = memos.filter(m => !m.selected);
            exitSelect();
        };

        // è¿”å›ï¼ˆé€€å‡ºé€‰æ‹©æ¨¡å¼ï¼‰æŒ‰é’®å¤„ç†
        document.getElementById('memo-back-btn').onclick = () => {
            exitSelect();
        };

        /* æ–°å»º */
        document.getElementById("memo-new-btn").onclick = () => {
            openDetail(null);
        };

        /* æ‰“å¼€è¯¦æƒ…ç•Œé¢ */
        function openDetail(id) {
            detailDom.style.display = "block";

            clearWarning();

            editingId = id;

            if (id === null) {
                titleDom.value = "";
                contentDom.value = "";
                renderTags([]);
            } else {
                const m = memos.find(x => x.id === id);
                titleDom.value = m.title;
                contentDom.value = m.content;
                renderTags(m.tags);
            }
        }

        /* å…³é—­è¯¦æƒ… */
        document.getElementById("memo-detail-close").onclick = () => {
            const title = titleDom.value.trim();
            const content = contentDom.value.trim();
            const tags = Array.from(tagsDom.children)
                .filter(n => n.dataset.tag)
                .map(n => n.dataset.tag);

            // å¦‚æœæœ‰æ ‡ç­¾æˆ–æ­£æ–‡ä½†æ— æ ‡é¢˜ï¼Œæé†’å¹¶é˜»æ­¢å…³é—­/ä¿å­˜
            if (title === "" && (tags.length > 0 || content !== "")) {
                showWarning("æœ‰æ­£æ–‡æˆ–æ ‡ç­¾ä½†æ²¡æœ‰æ ‡é¢˜ï¼Œè¯·å¡«å†™æ ‡é¢˜æˆ–åˆ é™¤æ­£æ–‡/æ ‡ç­¾ã€‚ç‚¹å‡»æ ‡é¢˜å¯ç»§ç»­ç¼–è¾‘ã€‚");
                titleDom.focus();
                return;
            }
            /* æ–°å»ºä¸”ä¸ºç©º â†’ ä¸ä¿å­˜ */
            if (editingId === null) {
                if (title === "" && content === "") {
                    closeDetail();
                    return;
                }
                memos.push({
                    id: Date.now(),
                    title, content, tags
                });
                closeDetail();
                renderList();
                return;
            }

            /* ç¼–è¾‘ä¸”ä¸ºç©º â†’ åˆ é™¤ */
            if (title === "" && content === "") {
                memos = memos.filter(m => m.id !== editingId);
                closeDetail();
                renderList();
                return;
            }

            /* æ™®é€šä¿å­˜ */
            const m = memos.find(x => x.id === editingId);
            m.title = title;
            m.content = content;
            m.tags = tags;

            closeDetail();
            renderList();
        };

        function closeDetail() {
            detailDom.style.display = "none";
            document.getElementById("memo-search").value = "";
            clearWarning();
        }

        function showWarning(msg) {
            if (!warningDom) return;
            warningDom.textContent = msg;
            warningDom.style.display = 'block';
        }

        function clearWarning() {
            if (!warningDom) return;
            warningDom.textContent = '';
            warningDom.style.display = 'none';
        }

        /* æ ‡ç­¾é€»è¾‘ */
        function renderTags(list) {
            tagsDom.innerHTML = "";
            clearWarning();

            list.forEach(tag => {
                const t = document.createElement("span");
                t.className = "memo-tag";
                t.dataset.tag = tag;

                const tagText = document.createElement("span");
                tagText.textContent = tag;
                t.appendChild(tagText);

                const deleteBtn = document.createElement("button");
                deleteBtn.className = "memo-tag-delete";
                deleteBtn.textContent = "âœ–";
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    renderTags(list.filter(x => x !== tag));
                };
                t.appendChild(deleteBtn);

                tagsDom.appendChild(t);
            });

            if (list.length < 3) {
                const add = document.createElement("div");
                add.className = "memo-tag-add";
                add.textContent = "+";

                add.onclick = () => {
                    // åˆ›å»ºå†…è”è¾“å…¥æ¡†ï¼ˆä¸ä¼šä½¿ç”¨ prompt/alertï¼‰
                    const inputBox = document.createElement('div');
                    inputBox.className = 'memo-tag-input-box';

                    const input = document.createElement('input');
                    input.className = 'memo-tag-input';
                    input.placeholder = 'æ–°æ ‡ç­¾ï¼ˆâ‰¤4å­—ï¼‰';
                    input.maxLength = 12;

                    const ok = document.createElement('button');
                    ok.textContent = 'âœ“';
                    ok.style.padding = '4px 8px';

                    const cancel = document.createElement('button');
                    cancel.textContent = 'âœ–';
                    cancel.style.padding = '4px 8px';

                    const err = document.createElement('div');
                    err.className = 'memo-tag-error';
                    err.style.display = 'none';

                    input.addEventListener('input', () => {
                        if (input.value.trim().length > 4) {
                            err.textContent = 'ä¸èƒ½è¶…è¿‡4å­—';
                            err.style.display = 'block';
                        } else {
                            err.textContent = '';
                            err.style.display = 'none';
                        }
                    });

                    ok.addEventListener('click', () => {
                        const nt = input.value.trim();
                        if (!nt) {
                            renderTags(list);
                            return;
                        }
                        if (nt.length > 4) {
                            err.textContent = 'ä¸èƒ½è¶…è¿‡4å­—';
                            err.style.display = 'block';
                            return;
                        }
                        renderTags([...list, nt]);
                    });

                    cancel.addEventListener('click', () => {
                        renderTags(list);
                    });

                    inputBox.appendChild(input);
                    inputBox.appendChild(ok);
                    inputBox.appendChild(cancel);
                    inputBox.appendChild(err);

                    tagsDom.appendChild(inputBox);
                    input.focus();
                };

                tagsDom.appendChild(add);
            }
        }

        // æ¸…é™¤è­¦å‘Šï¼Œå½“ç”¨æˆ·å¼€å§‹è¾“å…¥æ ‡é¢˜æˆ–æ­£æ–‡æ—¶
        titleDom.oninput = clearWarning;
        contentDom.oninput = clearWarning;

        /* åˆæ¬¡æ¸²æŸ“ */
        renderList();
    </script>

</body>

</html>